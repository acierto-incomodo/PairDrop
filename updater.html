<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Actualizador PairDrop</title>
    <style>
      :root {
        --bg-color: #f3f4f6;
        --text-color: #1f2937;
        --accent-color: #3b82f6;
        --accent-hover: #2563eb;
        --secondary-color: #6b7280;
        --secondary-hover: #4b5563;
        --disabled-color: #9ca3af;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --bg-color: #1f2937;
          --text-color: #f3f4f6;
          --accent-color: #60a5fa;
          --accent-hover: #3b82f6;
          --secondary-color: #9ca3af;
          --secondary-hover: #6b7280;
          --disabled-color: #4b5563;
        }
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        padding: 20px;
        box-sizing: border-box;
        text-align: center;
      }
      h2 {
        margin-top: 0;
        color: var(--accent-color);
      }
      p {
        margin: 10px 0;
      }
      .version-info {
        font-size: 0.9em;
        color: var(--secondary-color);
        margin-bottom: 20px;
      }
      #status {
        font-weight: bold;
        margin-bottom: 15px;
        min-height: 24px;
      }

      progress {
        width: 100%;
        height: 20px;
        margin-bottom: 15px;
        display: none;
      }

      button {
        background-color: var(--accent-color);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
        margin: 5px;
      }
      button:hover {
        background-color: var(--accent-hover);
      }
      button:disabled {
        background-color: var(--disabled-color);
        cursor: not-allowed;
      }
      button.secondary {
        background-color: var(--secondary-color);
      }
      button.secondary:hover {
        background-color: var(--secondary-hover);
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <h2>Actualización de PairDrop</h2>
    <div class="version-info">
      Versión actual: <span id="current-version">...</span>
    </div>

    <p id="status">Comprobando estado...</p>

    <progress id="progress-bar" value="0" max="100"></progress>

    <div id="controls">
      <button id="check-btn" onclick="checkForUpdates()">
        Buscar actualizaciones
      </button>
      <button id="download-btn" class="hidden" onclick="downloadUpdate()">
        Descargar
      </button>
      <button id="install-btn" class="hidden" onclick="quitAndInstall()">
        Reiniciar e Instalar
      </button>
      <button id="back-btn" class="secondary" onclick="goHome()">Volver</button>
    </div>

    <script>
      const statusEl = document.getElementById("status");
      const progressBar = document.getElementById("progress-bar");
      const checkBtn = document.getElementById("check-btn");
      const downloadBtn = document.getElementById("download-btn");
      const installBtn = document.getElementById("install-btn");
      const versionSpan = document.getElementById("current-version");

      // Inicialización
      (async () => {
        const version = await window.electronAPI.getAppVersion();
        versionSpan.textContent = version;
        checkForUpdates();
      })();

      function checkForUpdates() {
        statusEl.textContent = "Buscando actualizaciones...";
        progressBar.classList.add("hidden");
        checkBtn.disabled = true;
        downloadBtn.classList.add("hidden");
        installBtn.classList.add("hidden");

        window.electronAPI.checkForUpdates();
      }

      function downloadUpdate() {
        statusEl.textContent = "Iniciando descarga...";
        downloadBtn.disabled = true;
        progressBar.classList.remove("hidden");
        progressBar.value = 0;
        window.electronAPI.downloadUpdate();
      }

      function quitAndInstall() {
        window.electronAPI.quitAndInstall();
      }

      function goHome() {
        window.electronAPI.goHome();
      }

      // Eventos desde Main
      window.electronAPI.onUpdateAvailable((event, info) => {
        statusEl.textContent = `¡Nueva versión disponible: ${info.version}!`;
        checkBtn.classList.add("hidden");
        downloadBtn.classList.remove("hidden");
        downloadBtn.disabled = false;
      });

      window.electronAPI.onUpdateNotAvailable((event, info) => {
        statusEl.textContent = "Tienes la última versión instalada.";
        checkBtn.disabled = false;
        checkBtn.textContent = "Buscar de nuevo";
      });

      window.electronAPI.onDownloadProgress((event, progressObj) => {
        const percent = Math.round(progressObj.percent);
        statusEl.textContent = `Descargando: %`;
        progressBar.value = percent;
      });

      window.electronAPI.onUpdateDownloaded((event, info) => {
        statusEl.textContent = "Descarga completada. Listo para instalar.";
        progressBar.value = 100;
        downloadBtn.classList.add("hidden");
        installBtn.classList.remove("hidden");
      });

      window.electronAPI.onUpdateError((event, message) => {
        statusEl.textContent = "Error: " + message;
        checkBtn.disabled = false;
        progressBar.classList.add("hidden");
      });
    </script>
  </body>
</html>
